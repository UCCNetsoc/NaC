---
- name: Ensure Python 3
  become: yes
  raw: test -e /usr/bin/python3 || (apt -y update && apt install -y python3)
  register: result
  changed_when: "result.rc != 0"

- name: Gather facts
  setup:

- name: Ensure python3-distutils
  apt:
    name: python3-distutils

- name: Ensure pip installed
  apt:
    name: python3-pip

- name: Ensure upgraded pip and ansible pip requirements
  become: yes
  pip:
    name:
      - pip
      - ansible==2.9.10
      - proxmoxer
      - netaddr
    state: latest
    extra_args: --upgrade

- name: Ensure Galaxy roles
  command: ansible-galaxy collection install {{ item }}
  with_items:
    - freeipa.ansible_freeipa
  ignore_errors: yes
